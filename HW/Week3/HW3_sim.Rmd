---
title: "HW3"
author: "Neal Marquez"
date: "October 16, 2017"
output: pdf_document
---

# Question 1

$$
\begin{aligned}
P(X_{n+1} = X_{n} - 1 | X_n) = \frac{X_n(1-p)}{N} \\
P(X_{n+1} = X_{n} + 1 | X_n) = \frac{p(N-X_n)}{N} \\
P(X_{n+1} = X_n | X_n) = \frac{N - pN - X_n + 2pX_n}{N}
\end{aligned}
$$

$$
\begin{bmatrix}
   1-p & p & \dots & \dots & 0 \\
   \frac{1-p}{N} & \frac{N-pN-1+2p}{N} & \dots & \dots & 0 \\
   \vdots & \vdots & \ddots & \dots & 0 \\
   \vdots & \vdots & \vdots & \frac{pN - 2p + 1}{N} & \frac{p}{N} \\
   0 & 0 & 0 & 1-p & p
\end{bmatrix} 
$$

# Question 2a

```{r}
set.seed(123)
M <- 20
N <- 10
i <- 3
p <- .29

run_gamblers_ruin <- function(M, N, i, p, quietly=TRUE){
  i_start <- as.integer(rep(i, M))
  chain <- lapply(i_start, function(x) x)

  for(j in 1:M){
    end_pos <- chain[[j]]
    if(!quietly){
      cat(paste0("Starting chain number: ", j, "\n"))
    }
    while(end_pos != 0 & end_pos != N){
      if(!quietly){
        cat(paste0(end_pos, "\n"))
      }
      result <- rbinom(1, 1, prob=p)
      action <- 1^result *  (-1)^(1 - result)
      chain[[j]] <- c(chain[[j]], end_pos + action)
      end_pos <- chain[[j]][length(chain[[j]])]
    }
  }
  
  return(chain)
}

run_gamblers_ruin(M, N, i, p)
```

# Question 2b

```{r}
set.seed(123)
M <- 1000000
i <- 4
N <- 10

system.time(end_results <- sapply(seq(.1, .9, by=.1), function(p_)
  sapply(run_gamblers_ruin(M, N, i, p_), function(x) x[length(x)] == N)))

summary(end_results)

plot(seq(.1, .9, .1), colMeans(end_results), "l", 
     xlab = "Probability of Fortune", ylab="h(4,p)",
     main="Probability of Succesful Gambler")  
```

```{r}
M <- 1000
trans <- matrix(c(.03, .63, .34, .54, .04, .42, 0, 0, 0), 3, 3, byrow=T)
state <- sapply(1:M, function(x) c(1, 0, 0)) 
rownames(trans) <- c("{2,1}", "{1,2}", "end")
colnames(trans) <- c("{2,1}", "{1,2}", "end")

print(trans)

for(i in 1:(M-1)){
  state_i <- state[,i]
  state[,i+1] <- c(state_i %*% trans)
}

death_prob <- 1:M * state[3,]
print(sum(death_prob))
```

```{r}
alpha_ <- .7
beta_ <- .5
gamma_ <- .35

trans_shot <- matrix(c((1-alpha_)*(1-beta_)*(1-gamma_), 
         0, 
         (1-alpha_) * ((1-beta_)*gamma_ + beta_*(1-gamma_) + beta_*gamma_),
         alpha_ * (1-beta_)*(1-gamma_),
         0, 
         0, 
         alpha_ * ((1-beta_)*gamma_ + beta_*(1-gamma_) + beta_*gamma_),
         0,
         0, 0, (1-beta_)*(1-gamma_), 0, 0, (beta_)*(1-gamma_), (1-beta_)*(gamma_), (beta_)*(gamma_),
         0, 0, 0, (1-alpha_)*(1-gamma_), (alpha_)*(1-gamma_), 0, (1-alpha_)*(gamma_), (alpha_)*(gamma_)
         ), 3, 8, T)

rownames(trans_shot) <- c("{A,B,C}", "{B,C}", "{A,C}")
colnames(trans_shot) <- c("{A,B,C}", "{A,C}", "{B,C}", "{A,C}", "{A}", "{B}", "{C}", "NULL")
trans_shot
```